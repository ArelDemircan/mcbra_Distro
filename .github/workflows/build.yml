name: Ozel Ubuntu Distromu Derle ve Yayinla

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build-iso:
    runs-on: ubuntu-latest
    
    # GitHub'ın Sürüm (Release) oluşturabilmesi için zorunlu izin
    permissions:
      contents: write 

    steps:
    - name: Kodlari Sunucuya Cek
      uses: actions/checkout@v4

    - name: ISO Yapim Araclarini Yukle
      run: |
        sudo apt-get update
        sudo apt-get install -y debootstrap squashfs-tools xorriso grub-pc-bin grub-efi-amd64-bin mtools

    - name: Derleme Senaryosunu Calistir
      run: |
        chmod +x build.sh
        sudo ./build.sh
        
    - name: Hazir ISO'yu Tam Hizda Indirmek Icin Yayinla (Release)
      uses: softprops/action-gh-release@v2
      with:
        # Her derlemede otomatik yeni bir numara atar
        tag_name: "v1.0.${{ github.run_number }}"
        name: "mcbra OS - Hızlı İndirme (Derleme #${{ github.run_number }})"
        body: "Otomatik derlenmiş en güncel mcbra_Distro ISO dosyası. Artifact limitine takılmadan tam hızda indirebilirsiniz."
        files: output/*.iso
